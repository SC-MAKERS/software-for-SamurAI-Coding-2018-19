<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <link rel="stylesheet" type="text/css" href="samurai-docs.css">
  </head>
  <body>
    <h1>SamurAI Jockey 2018 ゲームルール</h1>
    <div class='centered'>
      2018年○月☓日<br>
      情報処理学会プログラミングコンテスト委員会
    </div>
    <div class="abstract">
      SamurAI Coding 2018-19 に用いるゲームのルールを述べる. 
      このルール案は暫定版であり, 詳細については今後の改訂の可能性がある. 
    </div>

    <h2>ゲームの概要</h2>
    <p>
      1回の<b>レース</b>は, 
      ふたりのプレイヤがスタート位置から開始し, 
      障害物や水濠が設置されたレースコース上で<b>ステップ</b>ごとに加速・減速しながら, 
      ゴールに到達する速さを競うゲームである. 
      プレイヤの動きはステップごとにAIプログラム (以下単に<b>AI</b>と呼ぶ) が制御する. 
    </p>
    <p>
      ひとつの<b>ゲーム</b>は, 
      同じ<b>レースコース</b>で両プレイヤのスタート位置を交換した2回のレースからなる. 
      両レースのゴールタイムの合計が短い方がゲームの勝者である. 
      合計タイムが同一である場合は, そのゲームは引き分けである. 
    </p>

    <figure style="float:right; width: 50%;">
      <img src="../screenshots/sample-course.png"
	   style="width: 100%; object-fit: scale-down">
      <figcaption>レースコースの例</figcaption>
      <p style="margin: 10px">
	このコースは幅16, 長さ20で, 両プレイヤは (0,&nbsp;3) および (0,&nbsp;7) に位置している. 
      </p>
    </figure>

    <h2>レースコース</h2>
    <p>
      レースコースは2次元の枡目からなり, ゲーム毎に幅・長さや障害物・水濠の位置が異なる. 
      以下では<b>コース幅</b>を <i>w,</i> <b>コース長</b>を <i>l</i> とし,
      各枡目の座標を (<i>x,&nbsp;y</i>) とする.
    </p>
    <p>
      各ステップの開始時, 終了時においてプレイヤはいずれかの枡目にある. 
      プレイヤはコース幅の外に出ることはできない. 
      すなわち <i>x</i>&nbsp;&lt;&nbsp;0 または <i>x</i>&nbsp;&ge;&nbsp;<i>w</i>
      の座標を持つ枡目には行けない. 
      プレイヤが <i>y</i>&nbsp;&ge;&nbsp;<i>l</i> の枡目に到達した際には, 
      そのプレイヤはゴールしたことになる. 
      スタート位置より後ろの <i>y</i>&nbsp;&lt;&nbsp;0 の枡目にも到達できる. 
    </p>
    <p>
      ゲーム開始時には, 両プレイヤは <i>y</i> 座標が0で,
      <i>x</i> 座標が
      0&nbsp;&le;&nbsp;<i>x</i>&nbsp;&lt&nbsp;<i>w</i>
      であるような互いに相異なる枡目に位置する. 
    </p>
    <p>
      コース上の枡目の一部は<b>障害</b>あるいは<b>水濠</b>である. 
      障害や水濠の枡目は固定されており, レース中に変化することはない. 
      障害や水濠の座標は
      0&nbsp;&le;&nbsp;<i>x</i>&lt;&nbsp;<i>w,</i> 
      0&nbsp;&le;&nbsp;<i>y</i>&lt;&nbsp;<i>l</i> 
      の範囲に限られる. 
      つまり, コース幅の外, スタート位置より前, ゴールより後には存在しない. 
    </p>
    <p>
      右図にレースコースの例を示す. 
      枡目のアイコンの意味は以下のとおりである. 
    </p>
    <table>
      <tr>
	<td><img src="../icons/lawn.png" width="40px"></td>
	<td><img src="../icons/obstacle.png" width="40px"></td>
	<td><img src="../icons/jump.png" width="40px"></td>
	<td><img src="../icons/withPlayer0.png" width="40px"></td>
	<td><img src="../icons/withPlayer1.png" width="40px"></td>
      </tr>
      <tr>
	<td>通常</td>
	<td>障害</td>
	<td>水濠</td>
	<td colspan="2">プレイヤの位置</td>
      </tr>
      <tr>
      </tr>
    </table>

    <p>
      コースには行き止まりがないものとする. 
      レース開始時の両プレイヤの位置から到達可能なコース内のどの枡目からも, 
      十分小さい速度で移動すれば, 
      一度も <i>y</i>座標を減らすことなく障害やコース端にぶつからずに
      <i>y</i>座標がより大きい点に移動できる. 
    </p>

    <h2>視界の制約</h2>
    <p>
      AIにはコースの各枡目が障害, 水濠, その他のいずれであるかを通知される. 
      各ステップにおいて情報が与えられる枡目は, 
      その <i>y</i> 座標が<b>視界限界</b>以下のもののみである. 
      視界限界は, 当該ステップまでにいずれかのプレイヤが達した <i>y</i> 座標の最大値に, 
      コースごとに定める<b>視界距離</b>を加えたものである. 
    </p>
    <p>
      視界限界はいずれかが到達した <i>y</i> 座標の最大値によって決まるので, 
      ステップの進行に伴って単調に増加する. 
      つまり, プレイヤが <i>y</i> 座標が小さい方向に逆行しても, 
      視界限界が小さくなることはない. 
    </p>
    <p>
      両プレイヤの視界限界は同一であり, 
      したがって両プレイヤが得られるコースの情報も同一である. 
    </p>
    <p>
      上掲のレースコース例の図中で, 
      コース画面の上半分程度の白く紗がかかっている枡目は, 
      初期状態での視界の外にあることを表している. 
      この例では視界距離は10である. 
      レースの進行に伴っていずれかのプレイヤがより大きい <i>y</i> 座標まで進めば, 
      それにしたがって視界も広がる. 
    </p>

    <h2>レースの進行</h2>
    <p>
      各レースでは, ステップごとに AI にレースの状況についての情報を与え, 
      それに対して AI は加減速の指示を応答する. 
      その指示によってプレイヤは加減速され, 
      レースの状況は更新される. 
      このステップを両プレイヤが共にゴールまたは失格するまで繰り返す. 
      ただし, 
      レースコースごとに定める制限ステップ数に達してもゴールしないプレイヤがある場合, 
      その時点でレースは終了し, ゴールに達していないプレイヤは失格となる. 
    </p>

    <h3>考慮時間</h3>
    <p>
      AI が1レースで使える<b>考慮時間</b>の合計には, 制限を設ける. 
      考慮時間はゲーム管理プログラムがプレイヤに情報を送信し終わってから, 
      プレイヤからの応答を受信し終わるまでの実時間である. 
      考慮時間の合計が制限値を超えたプレイヤは失格となる. 
    </p>

    <h3>プレイヤの状態</h3>
    <p>
      プレイヤは各ステップ開始時の状態として位置する枡目の座標と速度を持つ. 
      位置と速度はいずれも2次元のベクトルで, 両要素は整数値である. 
      以下, ステップ開始時のプレイヤの位置を (<i>x,&nbsp;y</i>),
      <b>速度</b>を (<i>v<sub>x</sub>,&nbsp;v<sub>y</sub></i>) とする. 
    </p>
    <p>
      各ステップ開始時の状態は, 前ステップ終了時の状態と同じである. 
      ただし, レース開始時の最初のステップでは, 
      位置がコースに指定された初期位置, 
      速度は (0,&nbsp;0) である. 
    </p>

    <h3>加減速</h3>
    <p>
      AI はステップごとに速度を変更する<b>加速度</b>
      (<i>a<sub>x</sub>,&nbsp;a<sub>y</sub></i>)を指示する. 
      <i>a<sub>x</sub>,&nbsp;a<sub>y</sub></i> は各々 -1, 0, 1 のいずれかである. 
      後述するコースアウトや衝突によって停止する場合を除き, 
      ステップ終了時のプレイヤの枡目は
      (<i>x+v<sub>x</sub>+a<sub>x</sub>,&nbsp;y+v<sub>y</sub>+a<sub>y</sub></i>) となる. 
      これを以下では次ステップにおける<b>予定位置</b>と呼ぶ. 
      このとき予定位置が水濠でなければ, 次ステップにおけるプレイヤの速度は
      (<i>v<sub>x</sub>+a<sub>x</sub>,&nbsp;v<sub>y</sub>+a<sub>y</sub></i>)
      となる. 
    </p>

    <figure style="float:right; width: 25%">
      <img src="../screenshots/off-the-track.png"
	   style="margin: auto; width: 100%; height: 100%;
		  object-fit: scale-down">
      <figcaption>コースアウト</figcaption>
    </figure>

    <h3>動線とコースアウト</h3>
    <p>
      ステップ開始前にプレイヤが位置する枡目の中心と, 
      終了時の予定位置の枡目の中心を両端とする線分を, 
      このプレイヤの当該ステップでの<b>動線</b>と呼ぶ. 
    </p>
    <p>
      以下の場合, 当該プレイヤは<b>コースアウト</b>を生じているという. 
      <ul>
	<li>
	  予定位置がコース幅の外である, 
	  すなわち予定位置の <i>x</i> 座標が
	  0&nbsp;&le;&nbsp;<i>x</i>&nbsp;&lt&nbsp;<i>w</i>
	  を満たさない. 
	</li>
	<li>
	  動線が障害の枡と交差あるいは接する. 
	</li>
      </ul>
      右図中の赤い動線 a, b, c, d はコースアウトであり, 
      青の動線 e, f はコースアウトではない.
      動線 a, b は障害の枡目と交差しており,
      動線 c は障害の枡目の角と接している.
      動線 d は予定位置がコース幅の外である。
    </p>
    <p>
      コースアウトしたプレイヤのステップ終了時の位置は開始時と変化しない. 
      また, 速度は (0,&nbsp;0) すなわち停止状態となる. 
    </p>

    <h3>衝突と優先権</h3>
    <p>
      コースアウトがなく, 両プレイヤの動線が交差あるいは接触する場合, 
      <b>衝突</b>が生じたという. 
    </p>
    <p>
      衝突が生じた場合, 
      <b>優先権</b>を持つプレイヤはステップ終了時に予定位置に動くが, 
      優先権のないプレイヤの位置は元のままで,
      速度は (0,&nbsp;0) すなわち停止状態になる. 
    </p>

    <figure style="float:right; width: 45%; margin: 0px 0px 10px 10px;">
      <table style="padding: 10px; spacing: 0px;">
	<tr>
	  <td>
	    <img src="../screenshots/collision-1.png"
		 style="width: 100%; object-fit: scale-down">
	  </td>
	  <td>
	    <img src="../screenshots/collision-2.png"
		 style="width: 100%; object-fit: scale-down">
	  </td>
	</tr>
	<tr>
	  <td>Case 1</td>
	  <td>Case 2</td>
	</tr>
	<tr>
	  <td>
	    <img src="../screenshots/collision-3.png"
		 style="width: 100%; object-fit: scale-down">
	  </td>
	  <td>
	    <img src="../screenshots/collision-4.png"
		 style="width: 100%; object-fit: scale-down">
	  </td>
	</tr>
	<tr>
	  <td>Case 3</td>
	  <td>Case 4</td>
	</tr>
      </table>
      <figcaption>衝突と優先権</figcaption>
    </figure>

    <p>
      優先権を持つのは, 
      ステップ開始時の位置の <i>y</i> 座標がより小さいプレイヤである. 
      <i>y</i> 座標が同じ場合, <i>x</i>座標がより小さいプレイヤが優先権を持つ. 
      ただし, 動線が相手プレイヤのステップ開始時の位置の枡目と交差あるいは接する場合は, 
      優先権は相手プレイヤに移る. 
    </p>
    <p>
      衝突した両プレイヤが互いに相手のステップ開始時の位置の枡目と交差あるいは接する場合, 
      両者とも優先権を失い, 次のステップでの位置は元のまま, 
      速度は (0,&nbsp;0) となる. 
    </p>
    <p>
      右図に掲げる具体例について説明する.
      <ul>
	<li>
	  Case 1 では,
	  青い動線のプレイヤのステップ開始時の <i>y</i> 座標の方が小さいので,
	  このプレイヤが優先権を得た.
	</li>
	<li>
	  Case 2 では,
	  赤い動線のプレイヤの動線は相手プレイヤのステップ開始時の位置の枡目と接しているので,
	  青い動線のプレイヤが優先権を得た.
	</li>
	<li>
	  Case 3 では, 
	  <i>y</i> 座標の小さいプレイヤの動線は相手プレイヤのステップ開始時の位置の枡目を通るが,
	  互いの動線は交差も接触もしていないので, そもそも衝突ではない.
	</li>
	<li>
	  Case 4 では衝突が生じており,
	  両者の動線は共に相手のステップ開始時の位置の枡目と交差あるいは接しているので,
	  両者ともに次のステップでの位置は元のまま, 
	  速度は (0,&nbsp;0) となる.
	</li>
      </ul>
    </p>

    <h3>水濠</h3>
    <p>
      ステップ開始時の位置の枡目が水濠である場合,
      そのプレイヤのステップ開始時の速度は (0,&nbsp;0) になる.
      したがって, 水濠から出発するステップは (&plusmn;1,&nbsp;&plusmn;1) の範囲でしか動けない.
    </p>

    <h3>ゴールとゴールタイム</h3>
    <p>
      プレイヤがステップ <i>s</i> の開始時に座標　(<i>x, y</i>) の位置の枡目にあり, 
      ステップ終了時に位置 (<i>x', y'</i>) に達し, 
      <i>y'</i>&nbsp;&ge;&nbsp;<i>l</i> であるとき, 
      そのプレイヤはゴールしたものとされる. 
      このとき<b>ゴールタイム</b>は
      <i>s</i>&nbsp;+&nbsp;(<i>l</i>&nbsp;&minus;&nbsp;<i>y</i>)&nbsp;/&nbsp;(<i>y'</i>&nbsp;&minus;&nbsp;<i>y</i>)
      となる. 
    </p>
    <p>
      ゴール時, 相手プレイヤがまだゴールも失格もしていなければ, 
      ゴールしたプレイヤをコースから取り除いた状態でレースを継続する. 
    </p>

    <h3>失格</h3>
    <p>
      プレイヤは以下のいずれかの場合, 当該プレイヤはそのレースについて<b>失格</b>となる. 
    </p>
    <ul>
      <li> 制限ステップ数に達してもゴールできなかった.</li>
      <li> 考慮時間の合計が制限値を超えた</li>
      <li> 後述の規定に反する出力を行った</li>
    </ul>
    <p>
      失格したステップまでに相手プレイヤがゴールも失格もしていなければ, 
      失格したプレイヤをコースから取り除いた状態でレースを継続する. 
      失格したプレイヤのゴールタイムは制限ステップ数の2倍とする. 
    </p>
    <p>
      なお, 失格は当該レースのみであり, 
      次以降のレースには通常通り参加できる. 
    </p>

    <h2>AIの入出力</h2>
    <p>
      AIは初期化時にレース全体に関する情報を入力し, 
      初期化終了を示す応答を出力する. 
      ステップごとにはレース状況の情報を入力し, 
      応答として加速度指示を出力する.
      ただし, ゴールあるいは失格したプレイヤのAIには,
      その後のステップではこのやりとりは行われない.
    </p>
    <p>
      入力はただひとつの空白あるいは改行で区切った10進整数の並びである. 
      負の数にはマイナス符号を前置する. 
      初期化時の入力およびステップごとの入力の最後は必ず改行を置く. 
    </p>
    <p>
      AIの応答出力も空白あるいは改行で区切った10進整数の並びで, 
      負の数にはマイナス符号を前置する. 
      <b>出力の最後には必ず改行を置く. </b>
    </p>

    <h3>初期化時の入力</h3>
    <p>
      初期化時のAIの入力は下記の項目がこの順に並ぶものである. 
      各項目の直後には改行が置かれ, 
      ひとつの項目 (1行) に含まれる複数の整数は<b>ひとつの空白</b>で区切られる. 
    </p>
    <ul>
      <li>
	考慮時間: このレースで使える合計考慮時間をミリ秒単位の整数値として. 
      </li>
      <li>
	制限ステップ数: ゴールまでのステップ数の上限を整数値として. 
      </li>
      <li>
	コースサイズ: コースの幅 <i>w</i> および長さ <i>l</i>をふたつの整数値として. 
      </li>
      <li>
	視界距離: 視界を決める距離を整数値として. 
      </li>
    </ul>
    <p class="notice">
      ここに初期化時の入力の例を掲げる予定。
    </p>

    <h3>初期化時の出力</h3>
    <p>
      AIは初期化が終了したことを整数 0 ひとつ及び改行で伝える. 
    </p>

    <h3>ステップごとの入力</h3>
    <p>
      ステップごとのAIの入力は下記の項目の整数がこの順に並ぶものである. 
      項目の間と最後にはには改行が置かれる.
      ひとつの項目に複数の整数が含まれる場合は<b>ひとつの空白</b>で区切られる.
      ただし, コースの枡目の情報についてのみは以下に述べる区切り方になる.
    </p>
    <ul>
      <li>
	ステップ: 当該のステップの番号を整数値として. 
	ステップ番号は 0 から始まる. 
      </li>
      <li>
	残り考慮時間: このレースで使える考慮時間の残りをミリ秒単位の整数値として. 
      </li>
      <li>
	自プレイヤの状態: 当該のAIが制御するプレイヤの位置のステップ開始時の位置の座標
	(<i>x, y</i>) と 速度 (<i>v<sub>x</sub>, v<sub>y</sub></i>) を, 
	この順に4整数値として. 
      </li>
      <li>
	相手プレイヤの状態: 相手プレイヤの位置のステップ開始時の位置の座標
	(<i>x, y</i>) と 速度 (<i>v<sub>x</sub>, v<sub>y</sub></i>) を, 
	この順に 4　整数値として. 
	ただし, 相手プレイヤが既にゴールしたか失格した場合は,
	0, <var>l</var>, 0, 0 の 4 整数になる.
      </li>
      <li>
	コースの枡目の情報:
	各枡目がどのような枡目であるかの情報で, 
	<i>w</i> 個の整数値からなる行を <i>l</i> 行, 
	計 <i>w</i>&nbsp;&times;&nbsp;<i>l</i> 個の整数値として与えられる. 
	各行内の複数の整数値はひとつの空白で区切られる.
	情報の順序は枡目の<i>y</i> 座標の昇順,
	同じ <i>y</i> 座標の枡目の中では <i>x</i> 座標の昇順である. 
	<br>
	情報の意味は以下の通りである. 
	<ul style="list-style: none;">
	  <li> 0: 当該の枡目は障害でも水濠でもない. </li>
	  <li> 1: 当該の枡目は障害である. </li>
	  <li> 2: 当該の枡目は水濠である. </li>
	  <li> &minus;1: 当該の枡目は視界の外であるため不明. </li>
	</ul>
      </li>
    </ul>
    <p class="notice">
      ここにステップごとのの入力の例を掲げる予定。
    </p>

    <h3>ステップごとの出力</h3>
    <p>
      AIは当該ステップの加速度 (<i>a<sub>x</sub>,&nbsp;a<sub>y</sub></i>)
      をふたつの整数で指定する. 
      <i>a<sub>x</sub></i> および <i>a<sub>y</sub></i>
      は &minus;1, 0, 1 のいずれかでなければならない. 
      各整数はひとつ以上の空白で区切り, 最後に改行を置く. 
    </p>

    <h3>情報の記憶</h3>
    <p>
      ゲーム管理システムは, 
      各ステップについて出力を終了したAIの動作を一時停止し, 
      次ステップの情報を与える際に動作を再開させる. 
      このため, ステップとステップの間に計算を進めることはできないが, 
      変数値などの実行コンテキストは1レースの間保持し続けることができる. 
    </p>
    <p>
      AIはファイル出力やネットワークアクセスができない環境で動作し, 
      ゲーム管理システムはレース毎にAIを初期状態から立ち上げ直す. 
      このため, AIは複数のレースの間で情報を受け渡すことはできない.
    </p>
    <div class="flushright">
      <p style="text-align: right">
	以上
      </p>
    </div>
  </body>
</html>
